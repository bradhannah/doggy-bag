# Implementation Plan: Detailed Monthly View

**Branch**: `002-detailed-monthly-view` | **Date**: 2025-12-31 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/002-detailed-monthly-view/spec.md`

## Summary

Create a Detailed Monthly View for day-to-day budget management that displays bills, expenses, and income organized by categories with section tallies. Features spreadsheet-like layout with Expected/Actual columns, partial payment tracking, due date indicators, ad-hoc items, and category configuration. All calculations use actuals only. This builds on existing 001-monthly-budget infrastructure.

## Technical Context

**Language/Version**: TypeScript (strict mode), Svelte 4.x, Bun 1.x  
**Primary Dependencies**: Svelte, Tauri, Bun HTTP server, existing API routes  
**Storage**: Local JSON files (data/entities/, data/months/)  
**Testing**: Bun test (backend), manual testing via curl + UI  
**Target Platform**: macOS, Windows, Linux (Tauri desktop)  
**Project Type**: Web application (Bun backend + Svelte frontend in Tauri shell)  
**Performance Goals**: <2 seconds to load month view, <500ms tally updates  
**Constraints**: <10MB bundle, offline-capable, no external network calls  
**Scale/Scope**: Single user, thousands of transactions, 12-24 months of data

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. User-Centric Simplicity | PASS | Spreadsheet-like but richer UX reduces cognitive load |
| II. Test-First Development | PASS | Will write tests before implementation |
| III. Incremental Delivery | PASS | 9 user stories, each independently testable |
| IV. Specification Before Implementation | PASS | spec.md complete with all requirements |
| V. Observability & Debuggability | PASS | Clear error messages, actionable next steps |
| XVI. Bun Backend | PASS | Extends existing Bun API on localhost:3000 |
| XVII. Backend Transparency | PASS | No user-facing logs, silent saves |
| XVIII. Tauri Desktop Shell | PASS | Svelte + Tauri, single executable |
| XIX. SvelteKit Frontend | PASS | Svelte components, Vite build |
| XX. Component Structure | PASS | One concern per component |
| XXI. Reactive Declarations | PASS | Svelte stores for cross-component state |
| XXIII. Scoped CSS Only | PASS | No Tailwind/Bootstrap |
| XXIV. No External UI Libraries | PASS | Custom components only |
| XXVII. Backend Testing | PASS | curl testing before user testing |

**All gates pass. No violations to justify.**

## Project Structure

### Documentation (this feature)

```text
specs/002-detailed-monthly-view/
├── plan.md              # This file
├── research.md          # Phase 0 output
├── data-model.md        # Phase 1 output (entity extensions)
├── quickstart.md        # Phase 1 output
├── contracts/           # Phase 1 output (API contracts)
│   ├── category-api.md
│   ├── partial-payments-api.md
│   └── adhoc-items-api.md
└── tasks.md             # Phase 2 output (generated by /speckit.tasks)
```

### Source Code (repository root)

```text
api/
├── src/
│   ├── controllers/
│   │   └── (existing controllers)
│   ├── models/
│   │   ├── category.ts       # Extended with sort_order, color, type
│   │   ├── bill.ts           # Extended with due_day
│   │   ├── income.ts         # Extended with due_day
│   │   └── payment.ts        # NEW: Partial payment entity
│   ├── services/
│   │   ├── categories-service.ts  # Extended with ordering/colors
│   │   ├── months-service.ts      # Extended with actual amounts, adhoc
│   │   └── payments-service.ts    # NEW: Partial payment service
│   ├── routes/
│   │   └── handlers/
│   │       ├── categories.handlers.ts  # Extended
│   │       ├── payments.handlers.ts    # NEW
│   │       └── adhoc.handlers.ts       # NEW
│   ├── types/
│   │   └── index.ts          # Extended with new types
│   └── utils/
│       └── (existing utils)
└── data/
    ├── entities/
    │   └── categories.json   # Extended with sort_order, color, type
    └── months/
        └── YYYY-MM.json      # Extended structure

src/
├── components/
│   ├── Dashboard/
│   │   └── (existing - remains high-level summary)
│   ├── DetailedView/
│   │   ├── DetailedMonthView.svelte    # Main container
│   │   ├── CategorySection.svelte       # Category header + items
│   │   ├── BillRow.svelte              # Single bill row
│   │   ├── IncomeRow.svelte            # Single income row
│   │   ├── PartialPaymentInput.svelte  # Paid / Expected input
│   │   ├── SectionTally.svelte         # Expected/Actual/Remaining
│   │   ├── SummaryFooter.svelte        # Leftover calculation
│   │   └── AdHocForm.svelte            # Add ad-hoc drawer
│   ├── Setup/
│   │   ├── CategoryConfig.svelte       # NEW: Drag-drop ordering
│   │   └── ColorPicker.svelte          # NEW: Category color picker
│   └── shared/
│       └── (existing shared components)
├── routes/
│   ├── +page.svelte          # Dashboard (unchanged)
│   ├── month/
│   │   └── [month]/
│   │       └── +page.svelte  # NEW: Detailed Monthly View route
│   └── setup/
│       └── +page.svelte      # Extended with category config
├── stores/
│   ├── months.ts             # Extended with actual amounts
│   ├── categories.ts         # Extended with ordering/colors
│   └── payments.ts           # NEW: Partial payments store
└── types/
    └── api.ts                # Regenerated from OpenAPI
```

**Structure Decision**: Extends existing web application structure from 001-monthly-budget. New route `/month/[month]` for Detailed View. Setup page extended with category configuration tab.

## Complexity Tracking

> No violations requiring justification.

| Aspect | Complexity | Justification |
|--------|------------|---------------|
| New route | Low | Single new route `/month/[month]` |
| Entity extensions | Low | Adding fields to existing entities |
| New Payment entity | Medium | Required for partial payment tracking |
| Category config UI | Medium | Drag-drop ordering, color picker |
