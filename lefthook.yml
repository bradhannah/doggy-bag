# Lefthook pre-commit hooks configuration
# https://lefthook.dev/configuration/
#
# Note: Using ~/.bun/bin/bunx instead of npx to avoid Node.js dependency
# Bun is the primary runtime for this project

pre-commit:
  parallel: true
  jobs:
    # TypeScript/Svelte linting
    - name: lint
      glob: '*.{ts,svelte}'
      run: ~/.bun/bin/bunx eslint {staged_files}

    # TypeScript/Svelte formatting (auto-format and re-stage)
    - name: format
      glob: '*.{ts,js,svelte,json,css,html,md}'
      run: ~/.bun/bin/bunx prettier --write {staged_files} && git add {staged_files}

    # Svelte type checking
    - name: typecheck
      run: ~/.bun/bin/bunx svelte-kit sync && ~/.bun/bin/bunx svelte-check --tsconfig ./tsconfig.json

    # Rust formatting (auto-format and re-stage)
    - name: rust-format
      glob: 'src-tauri/**/*.rs'
      run: cd src-tauri && cargo fmt && git add {staged_files}

    # Rust linting (Clippy with warnings as errors)
    - name: rust-lint
      glob: 'src-tauri/**/*.rs'
      run: cd src-tauri && cargo clippy -- -D warnings

    # Frontend tests (Vitest - fast)
    - name: test-frontend
      run: ~/.bun/bin/bunx vitest run

    # Backend tests (Bun - very fast)
    - name: test-backend
      run: cd api && ~/.bun/bin/bun test
